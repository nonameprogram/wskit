import { StyledLink } from '@/components/styled-link'
import { Tabs } from 'nextra/components';
import { Callout } from 'nextra/components'
import { version } from 'node:os';

<div className="hidden">
```ts twoslash include main
import { WsKit } from "websocketkit";
import Pusher from 'pusher-js';

declare module 'websocketkit' {
  interface ChannelRegistry {
    'application': {
      type: 'public';
      params: {};
      events: {
        newVersionAvailable: {
          version: string,
          timestamp: string,
        }
      };
    };
  }
}

const pusher = new Pusher('TEST', {cluster: 'mt1'});
const wskit = new WsKit(pusher);
// ---cut---

```
</div>

# Public channel

Public channels should be used for publicly accessible data as they do not require any form of authorization in order to be subscribed to.

You can subscribe and unsubscribe from channels at any time. Thereâ€™s no need to wait for the Channels to finish connecting first.

## Subscribe

Create a subscription to a specific channel. Provide any required parameters for public, private or presence channels.

```ts twoslash include sub
// @include: main
// ---cut---
const sub = wskit.subscribe('application', { type:'public', params: {} })
```

## Unsubscribe

Stop receiving events and clear all listeners from the subscription.

```ts twoslash
// @include: sub
// ---cut---
sub.dispose();
```

## Events

### Listen for an event

Subscribe to a specific event on the channel.

```ts twoslash
// @include: sub
// ---cut---
sub.on('newVersionAvailable', (event) => {
  /** Do something with the event **/
})
```

### Stop listening for an event

<Callout type="important">
This should only be used when you want to stop listening for a specific event without unsubscribing from the channel; otherwise, calling `sub.dispose()` is sufficient.
</Callout>

Remove a specific listener using either the returned unsubscribe function or the original callback reference.

<Tabs items={['Using returned unsubscribe function', 'Using original callback reference']}>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    const unsub = sub.on('newVersionAvailable', (event) => {
      /** Do something with the event **/
    })

    // Later
    unsub();
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    /** You have to explicitly define the type of the event **/
    const newVersionAvailableHandler = (event: { version: string, timestamp: string }) => {
      /** Do something with the event **/
    };

    sub.on('newVersionAvailable', newVersionAvailableHandler)

    // Later
    sub.off('newVersionAvailable', newVersionAvailableHandler);
    ```
  </Tabs.Tab>
</Tabs>

## Notifications

### Listen for a notification

Listen for `.Illuminate\\Notifications\\Events\\BroadcastNotificationCreated` event on a channel.

```ts twoslash
// @include: sub
// ---cut---
sub.notification((notif) => {
  /** Do something with a notification event **/
});
```

### Stop listening for a notification

<Callout type="important">
  This should only be used when you want to stop listening for a specific event without unsubscribing from the channel; otherwise, calling `sub.dispose()` is sufficient.
</Callout>

<Tabs items={['Using returned unsubscribe function']}>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    // Using returned unsubscribe function
    const unsub = sub.notification((notif) => {
      /** Do something with a notification event **/
    });

    unsub()
    ```
  </Tabs.Tab>
</Tabs>

## Internal Events

### Subscription succeeded

Triggered when the subscription is successfully established.

```ts twoslash
// @include: sub
// ---cut---
sub.subscribed(() => {
  /** Do something after successful subscription **/
})
```