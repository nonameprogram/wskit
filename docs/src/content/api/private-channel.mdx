import { StyledLink } from '@/components/styled-link'
import { Tabs } from 'nextra/components';
import { Callout } from 'nextra/components'


<div className="hidden">
```ts twoslash include main
import { WsKit } from "websocketkit";
import Pusher from 'pusher-js';

declare module 'websocketkit' {
  interface ChannelRegistry {
    'orders': {
      type: 'private';
      params: {};
      events: {
        orderShipped: {
          orderId: string,
          trackId: string,
          status: number,
          timestamp: string,
        }
      };
      whispers: {
        noteAdded: {
          orderId: string,
          note: string,
        }
      }
    };
  }
}

const pusher = new Pusher('TEST', {cluster: 'mt1'});
const wskit = new WsKit(pusher);
// ---cut---

```
</div>

# Private channel

Private channels should be used when access to the channel needs to be restricted in some way. In order for a user to subscribe to a private channel permission must be authorized.

## Subscribe

Create a subscription to a specific channel. Provide any required parameters for public, private or presence channels.

```ts twoslash include sub
// @include: main
// ---cut---
const sub = wskit.subscribe('orders', { type: 'private', params: {} })
```

## Unsubscribe

Stop receiving events and clear all listeners from the subscription.

```ts twoslash
// @include: sub
// ---cut---
sub.dispose();
```

## Events

### Listen for an event

Subscribe to a specific event on the channel.

```ts twoslash
// @include: sub
// ---cut---
sub.on('orderShipped', (event) => {
  /** Do something with the event **/
})
```

### Stop listening for an event

<Callout type="important">
  This should only be used when you want to stop listening for a specific event without unsubscribing from the channel; otherwise, calling `sub.dispose()` is sufficient.
</Callout>

Remove a specific listener using either the returned unsubscribe function or the original callback reference.

<Tabs items={['Using returned unsubscribe function', 'Using original callback reference']}>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    const unsub = sub.on('orderShipped', (event) => {
      /** Do something with the event **/
    })

    // Later
    unsub();
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    /** You have to explicitly define the type of the event **/
    const orderShippedHandler = (event: { orderId: string, trackId: string, status: number, timestamp: string }) => {
      /** Do something with the event **/
    };

    sub.on('orderShipped', orderShippedHandler);

    // Later
    sub.off('orderShipped', orderShippedHandler);
    ```
  </Tabs.Tab>
</Tabs>

## Notifications

### Listen for a notification

Listen for `.Illuminate\\Notifications\\Events\\BroadcastNotificationCreated` event on a channel.

```ts twoslash
// @include: sub
// ---cut---
sub.notification((notif) => {
  /** Do something with a notification event **/
});
```

### Stop listening for a notification

<Callout type="important">
  This should only be used when you want to stop listening for a specific event without unsubscribing from the channel; otherwise, calling `sub.dispose()` is sufficient.
</Callout>

<Tabs items={['Using returned unsubscribe function']}>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    const unsub = sub.notification((notif) => {
      /** Do something with a notification event **/
    });

    unsub()
    ```
  </Tabs.Tab>
</Tabs>

## Client Events

Communicate directly with other subscribers on the channel.

### Send a whisper

```ts twoslash
// @include: sub
// ---cut---
sub.whisper('noteAdded', { orderId: 'rBei1FD7egstHQrplQeou', note: 'Review required' });
```

### Listen for a whisper

<Callout type="important">
  This should only be used when you want to stop listening for a specific event without unsubscribing from the channel; otherwise, calling `sub.dispose()` is sufficient.
</Callout>

```ts twoslash
// @include: sub
// ---cut---
sub.listenForWhisper('noteAdded', (event) => {
  /** Do something with a notification event **/
});
```
### Stop listening for a whisper

<Tabs items={['Using returned unsubscribe function', 'Using original callback reference']}>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    // Using returned unsubscribe function
    const unsub = sub.listenForWhisper('noteAdded', (event) => {
      /** Do something with a notification event **/
    });

    unsub();
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```ts twoslash
    // @include: sub
    // ---cut---
    /** You have to explicitly define the type of the event **/
    const noteAddedHandler = (event: { orderId: string, note: string }) => {
      /** Do something with a notification event **/
    }

    sub.listenForWhisper('noteAdded', noteAddedHandler);

    // Later
    sub.stopListeningForWhisper('noteAdded', noteAddedHandler);
    ```
  </Tabs.Tab>
</Tabs>

## Internal Events

### Subscription succeeded

Triggered when the subscription is successfully established.

```ts twoslash
// @include: sub
// ---cut---
sub.subscribed(() => {
  /** Do something after successful subscription **/
})
```

### Subscription error

Triggered when authorization fails for private or presence channels. Internally, this listens for the `pusher:subscription_error` <StyledLink href="https://pusher.com/docs/channels/using_channels/events/#pushersubscription_error-1995773905">event</StyledLink>.

```ts twoslash
// @include: sub
// ---cut---
sub.error((error) => {
  /** Handle subscription error **/
})
```