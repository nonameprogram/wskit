import { StyledLink } from '@/components/styled-link'
import { Tabs } from 'nextra/components';

## Channel Subscription

Manage subscribing and unsubscribing from channels, handling events, whispers, and notifications.

### Subscribing to a channel

Create a subscription to a specific channel. Provide any required parameters for public, private or presence channels.

```ts
const sub = wskit.channel('chats.$chatId', { type: 'presence', params: { chatId } })
```

### Unsubscribing from a channel

Stop receiving events and clear all listeners from the subscription.

```ts
/** Clears all listeners and unsubscribes from the channel **/
sub.dispose();
```

### Subscription callbacks

Triggered when the subscription is successfully established.

```ts
sub.subscribed(() => {
 /** Do something after successful subscription **/
})
```

### Error callback

Triggered when authorization fails for private or presence channels. Internally, this listens for the `pusher:subscription_error` <StyledLink href="https://pusher.com/docs/channels/using_channels/events/#pushersubscription_error-1995773905">event</StyledLink>.

```ts
sub.error((error) => {
  /** Handle subscription error **/
})
```

## Listening for events

### Listen for an event

Subscribe to a specific event on the channel.

```ts
sub.on('messageReceived', (event) => {
  console.log(event.message);
})
```

### Stop listening

Remove a specific listener using either the returned unsubscribe function or the original callback reference.

```ts
// Using returned unsubscribe function
const unsub = sub.on('messageReceived', (event) => {
  console.log(event.message);
})

// Later
unsub();
```
```ts
// Using original callback reference
const messageReceivedHandler = (event) => {
  console.log(event);
};

sub.on('messageReceived', messageReceivedHandler)

// Later
sub.off(messageReceivedHandler);
```

## Whisper

Communicate directly with other subscribers on the channel.

### Send a whisper

```ts
sub.whisper('userIsTyping', { userId });
```

### Listen for a whisper

```ts
sub.listenForWhisper('userIsTyping', (event) => {
  console.log(event);
});
```
### Stop listening for a whisper

<Tabs items={['Using returned unsubscribe function', 'Using original callback reference']}>
  <Tabs.Tab>
    ```ts
    // Using returned unsubscribe function
    const unsub = sub.listenForWhisper('userIsTyping', (event) => {
      console.log(event);
    });

    unsub();
    ```
  </Tabs.Tab>
  <Tabs.Tab>
    ```ts
    // Using original callback reference
    const userIsTypingHandler = (event) => {
      console.log(event);
    }

    sub.listenForWhisper('userIsTyping', userIsTypingHandler);

    // Later
    sub.stopListeningForWhisper('userIsTyping', userIsTypingHandler);
    ```
  </Tabs.Tab>
</Tabs>

## Laravel notification

### Listen for a notification

Listen for `.Illuminate\\Notifications\\Events\\BroadcastNotificationCreated` event on channel.

```ts
sub.notification((notif) => {
  console.log(notif)
});
```

### Stop listening for a notification

<Tabs items={['Using returned unsubscribe function']}>
  <Tabs.Tab>
    ```ts
    // Using returned unsubscribe function
    const unsub = sub.notification((notif) => {
      console.log(notif)
    });

    unsub()
    ```
  </Tabs.Tab>
</Tabs>